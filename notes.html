<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Quick Notes - UniDesk</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Notes Specific Styles */
    .notes-header {
      background: #fff;
      padding: var(--spacing-lg) 20px;
      border-bottom: 2px solid var(--accent-quaternary);
      /* Deep Red Border */
      margin-bottom: var(--spacing-md);
    }

    .page-title {
      color: var(--accent-quaternary);
    }

    .notes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--spacing-md);
      padding: 0 20px var(--spacing-xl);
      max-width: 1400px;
      margin: 0 auto;
    }

    .note-card {
      background: #fff;
      border: 1px solid var(--border-color);
      padding: var(--spacing-md);
      border-radius: 4px;
      /* Slightly sharper corners for notes */
      position: relative;
      transition: var(--transition-smooth);
    }

    .note-card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-3px);
    }

    .note-card.voice {
      border-left: 4px solid #f59e0b;
    }

    .note-card.text {
      border-left: 4px solid var(--accent-quaternary);
    }

    .note-date {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .note-content {
      font-family: var(--font-body);
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text-primary);
      max-height: 150px;
      overflow: hidden;
    }

    /* Modal & Recorder Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-box {
      background: #fff;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      border-top: 5px solid var(--accent-quaternary);
    }

    .mic-btn-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent-quaternary);
      color: white;
      font-size: 2rem;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px auto;
      box-shadow: 0 5px 15px rgba(102, 34, 34, 0.3);
      transition: transform 0.2s;
    }

    .mic-btn-large:hover {
      transform: scale(1.1);
    }

    .mic-btn-large.recording {
      animation: pulse 1.5s infinite;
      background: #dc2626;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);
      }

      70% {
        box-shadow: 0 0 0 20px rgba(220, 38, 38, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
      }
    }
  </style>
</head>

<body>
  <nav class="main-nav navbar">
    <div class="container flex justify-between items-center" style="width:100%">
      <div class="brand-logo">UniDesk</div>
      <ul class="nav-links">
        <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
        <li><a href="projects.html" class="nav-link">Projects</a></li>
        <li><a href="aboutus.html" class="nav-link">About Us</a></li>
        <li><a href="profile.html" class="nav-link">Profile</a></li>
      </ul>
    </div>
  </nav>

  <div class="notes-header">
    <div class="container" style="max-width:1400px; padding:0;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 class="page-title" style="font-family:var(--font-heading); font-size:2.5rem;">Quick Notes</h1>
        <div style="display:flex; gap:10px;">
          <button class="btn" onclick="openTextModal()" style="background:var(--accent-quaternary);">+ Text
            Note</button>
          <button class="btn" onclick="openVoiceModal()" style="background:#f59e0b;">üé§ Voice Note</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="max-width:1400px; padding:0 20px; margin-bottom:20px;">
    <select id="typeFilter" onchange="applyFilters()" style="padding:8px; border:1px solid var(--border-color);">
      <option value="all">All Notes</option>
      <option value="text">Text Only</option>
      <option value="voice">Voice Notes</option>
    </select>
  </div>

  <div class="notes-grid" id="notesGrid">
    <!-- Generated by JS -->
  </div>

  <!-- Text Modal -->
  <div class="modal-overlay" id="textModal">
    <div class="modal-box">
      <h2 style="font-family:var(--font-heading); margin-bottom:15px;">New Note</h2>
      <textarea id="noteContent"
        style="width:100%; height:150px; padding:10px; border:1px solid var(--border-color); margin-bottom:15px; font-family:var(--font-body);"></textarea>
      <div style="display:flex; justify-content:flex-end; gap:10px;">
        <button class="btn-outline" onclick="closeModals()">Cancel</button>
        <button class="btn" onclick="saveTextNote()" style="background:var(--accent-quaternary);">Save</button>
      </div>
    </div>
  </div>

  <!-- Voice Modal -->
  <div class="modal-overlay" id="voiceModal">
    <div class="modal-box" style="text-align:center;">
      <h2 style="font-family:var(--font-heading);">Voice Note</h2>
      <button class="mic-btn-large" id="recordBtn" onclick="toggleRecording()">üé§</button>
      <p id="recStatus" style="color:var(--text-secondary);">Tap to Record</p>
      <button class="btn-outline" onclick="closeModals()" style="margin-top:20px;">Close</button>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin;
    const userEmail = sessionStorage.getItem('userEmail');
    if (!userEmail) window.location.href = 'index.html';

    let allNotes = [];
    let isRecording = false;

    document.addEventListener('DOMContentLoaded', loadNotes);

    async function loadNotes() {
      try {
        const res = await fetch(`${API_BASE}/notes/${encodeURIComponent(userEmail)}`);
        if (res.ok) {
          const data = await res.json();
          allNotes = Array.isArray(data) ? data : [];
          renderNotes(allNotes);
        }
      } catch (e) { console.error(e); }
    }

    function renderNotes(notes) {
      const grid = document.getElementById('notesGrid');
      if (!notes.length) {
        grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:var(--text-secondary); padding:50px;"><h3>No notes yet</h3></div>`;
        return;
      }

      grid.innerHTML = notes.map(note => `
            <div class="note-card ${note.type}">
                <div class="note-date">${new Date(note.created_date).toLocaleDateString()}</div>
                <div class="note-content">${note.type === 'voice' ? 'üé§ Voice Note' : note.content}</div>
                ${note.type === 'voice' ? '<div style="margin-top:10px; font-size:0.8rem; color:var(--text-secondary);">Audio playback not fully implemented in redesign demo</div>' : ''}
                <div style="margin-top:10px; display:flex; justify-content:flex-end;">
                    <button onclick="deleteNote(${note.id})" style="background:none; border:none; color:var(--text-secondary); cursor:pointer;">üóëÔ∏è</button>
                </div>
            </div>
        `).join('');
    }

    function applyFilters() {
      const type = document.getElementById('typeFilter').value;
      const filtered = type === 'all' ? allNotes : allNotes.filter(n => n.type === type);
      renderNotes(filtered);
    }

    // --- Modal & Actions ---
    function closeModals() {
      document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
    }
    function openTextModal() { document.getElementById('textModal').classList.add('active'); }
    function openVoiceModal() { document.getElementById('voiceModal').classList.add('active'); }

    async function saveTextNote() {
      const text = document.getElementById('noteContent').value;
      if (!text.trim()) return;

      try {
        await fetch(`${API_BASE}/notes`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userEmail, type: 'text', content: text })
        });
        document.getElementById('noteContent').value = '';
        closeModals();
        loadNotes();
      } catch (e) { alert('Error saving note'); }
    }

    async function toggleRecording() {
      const btn = document.getElementById('recordBtn');
      const status = document.getElementById('recStatus');

      // Mock Recording Logic for UI Demo
      if (!isRecording) {
        isRecording = true;
        btn.classList.add('recording');
        status.textContent = 'Recording... (Mock)';
      } else {
        isRecording = false;
        btn.classList.remove('recording');
        status.textContent = 'Saving...';

        // Auto-save mock voice note
        try {
          await fetch(`${API_BASE}/notes`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userEmail, type: 'voice', content: 'Voice Note' })
          });
          closeModals();
          loadNotes();
        } catch (e) { alert('Error saving voice note'); }

        status.textContent = 'Tap to Record';
      }
    }

    async function deleteNote(id) {
      if (!confirm('Delete note?')) return;
      try {
        await fetch(`${API_BASE}/notes/${id}`, { method: 'DELETE' });
        loadNotes();
      } catch (e) { }
    }

  </script>
</body>

</html>